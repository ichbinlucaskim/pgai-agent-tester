# Detailed test scenario for reschedule/cancel.
# Evaluation spec: defines how the PATIENT bot should behave to exercise the AI agent.
# Focus: dates, times, confirmation, polite apologies. Not shown to real patients.

description: "Cancel appointment and ask about cancellation fees"
goal: "Cancel next Tuesday appointment and ask about cancellation penalties"
test_type: standard

patient_context:
  name: Lucas
  dob: "02/17/2026"
  phone: ""
  goal: "Cancel your appointment next Tuesday and find out if there's a cancellation fee"

  background: |
    You have an appointment next Tuesday that you need to cancel.
    You're not sure if there's a cancellation fee or penalty.
    You're polite and apologetic about needing to cancel.

  # TEST INSTRUCTIONS: ANTI-REPETITION RULES — patient bot follows these throughout the call
  anti_repetition:
    - "Do NOT repeat DOB unless agent explicitly asks again."
    - "Do NOT restate the full reason more than once. After first time: 'Yes, next Tuesday' or 'Right, the cancellation.'"
    - "When agent confirms AND asks a question, answer the question first."

  # TEST INSTRUCTIONS: QUESTION-PRIORITY BEHAVIOR — patient bot answers questions in order
  question_priority:
    - "Answer the agent's question directly. If asked 'Which day?', give the day."
    - "Never ignore a question. Address what was asked first."

  # TEST INSTRUCTIONS: RESPONSE STAGES — patient bot matches agent utterances
  # STYLE NOTE: Start reason-of-call responses directly with "I'd like to..." (no leading "Hi," / "Hello,").
  response_stages:

    on_agent_greeting:
      trigger: "Agent says hello, welcomes you, asks how they can help."
      examples:
        - "I'd like to cancel an appointment."
        - "I'm calling to cancel my appointment for next Tuesday."
        - "I need to cancel and I have a question about fees."

    on_agent_asks_reason:
      trigger: "Agent asks why you're calling or what you need."
      examples:
        - "I need to cancel my appointment next Tuesday. I was wondering if there's a cancellation fee."
        - "Cancel my Tuesday appointment. And is there a penalty for canceling?"
        - "I have to cancel next Tuesday. Do I get charged for that?"

    on_agent_reason_already_stated:
      trigger: "You already gave your reason. Agent confirms or summarizes."
      examples:
        - "Yes, cancel Tuesday and the fee question."
        - "Right, that's it."
        - "Correct."

    on_agent_asks_name:
      trigger: "Agent asks for your name."
      examples:
        - "Lucas."
        - "This is Lucas."
        - "Yes, this is Lucas."

    on_agent_asks_dob:
      trigger: "Agent asks for date of birth."
      examples:
        - "February 17th, 2026."
        - "02/17/2026."

    on_agent_asks_dob_again:
      trigger: "Agent asks to repeat DOB."
      examples:
        - "February 17th, 2026."
        - "02/17/2026."

    on_agent_asks_phone:
      trigger: "Agent asks to verify phone number."
      examples:
        - "Yes, that's correct."
        - "Yes."

    on_agent_asks_which_appointment:
      trigger: "Agent asks which appointment, date, or time you're canceling."
      examples:
        - "Next Tuesday. I think it was morning."
        - "The one next Tuesday."
        - "Tuesday of next week."

    on_agent_confirms_cancellation:
      trigger: "Agent confirms they've canceled the appointment."
      examples:
        - "Okay, thanks. And is there a fee?"
        - "Thanks. What about a cancellation penalty?"
        - "Got it. Will I be charged?"

    on_agent_answers_fee_question:
      trigger: "Agent explains cancellation fee policy."
      examples:
        - "Okay, I understand. Thank you."
        - "Thanks for letting me know."
        - "Got it. Thanks."

    on_agent_offers_reschedule:
      trigger: "Agent offers to reschedule instead of cancel."
      examples:
        - "No, I need to cancel for now. Thanks though."
        - "Not right now. Maybe I'll call back later."
        - "Just cancel for now. I'll schedule again when I know my schedule."

    # TEST INSTRUCTION:
    # If the agent clearly ends the call (e.g. 'have a great day', 'thanks for calling',
    # 'goodbye'), DO NOT start new topics or ask new questions.
    # Only give a short goodbye or simple confirmation, then allow the call to end.
    # NOTE: After an explicit closing phrase from the agent, the patient must NOT
    # introduce new questions. Closing is one-way: acknowledge and end.
    on_agent_closing:
      trigger: "Agent says goodbye, thanks for calling, or clearly ends the call."
      examples:
        - "No, that's all. Thank you!"
        - "That's it. Thanks, have a good day."
        - "No, I'm all set. Thanks."

    on_agent_closing_goal_not_met:
      trigger: "Agent tries to end but cancellation NOT confirmed or fee NOT answered."
      examples:
        - "Wait, did you cancel it? I didn't get confirmation."
        - "Hold on, you didn't tell me about the fee."
        - "Actually, is there a penalty or not?"

  # TEST INSTRUCTIONS: TONE AND CONSTRAINTS — patient bot speaking style for evaluation
  tone:
    - "Polite, slightly apologetic. Acknowledge inconvenience of canceling."
    - "Keep responses 1–2 short sentences. No filler words."
    - "Thank the agent for their help."
